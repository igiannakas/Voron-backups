#####################################################################
#   Happy Hare includes
#####################################################################
[include mmu/base/*.cfg]
[include mmu/optional/mmu_menu.cfg]

#####################################################################
#   File locations and on error handling
#####################################################################

[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

 
#####################################################################
#   Device ID's
#####################################################################
[mcu]
canbus_uuid: c0f599d7bb14 

[mcu EBBCan]
canbus_uuid: cd407005594f 

# canbus_uuid: 7d06e01afee5 # Stealthburner
# MMU: b9552979a1b0

#####################################################################
#   Basic Klipper and Printer setup
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500
max_accel: 20000   	
max_z_velocity: 35		
max_z_accel: 300	
square_corner_velocity: 5
minimum_cruise_ratio: 0.0

[exclude_object]
[print_stats]

[gcode_arcs]
resolution: 0.05

[idle_timeout]
timeout: 3600

[force_move]
enable_force_move: True


#####################################################################
#   Includes
#####################################################################

## Configuration files
[include mainsail.cfg]
[include config/stealthburner_leds.cfg]
[include config/extruder.cfg]
[include config/steppers.cfg]
[include config/temperature_sensors.cfg]
[include config/homing.cfg]
[include config/fans.cfg]
[include config/disco.cfg]
[include config/input_shaper.cfg]
[include config/display.cfg]

## Macros
[include macros/stealthmax_macros.cfg]
[include macros/movement_macros.cfg]
[include macros/LED_macros.cfg]
[include macros/printing_macros.cfg]
[include macros/print_start_end.cfg]

## Cartographer macro
[include macros/cartographer_macros.cfg]

## MMU Macros
[include mmu/optional/client_macros.cfg]
[include mmu/addons/blobifier.cfg]
[include macros/custom_blobifier.cfg]
[include macros/custom_mmu_macros.cfg]




#####################################################################
#   Stepper current delayed gcode and notification infrastructure
#####################################################################

[gcode_macro MR_NOTIFY]
description: Allows you to send a custom notification via Mobileraker without using the M117 command
gcode:
    {% set msg = "MR_NOTIFY:" ~ (params.TITLE ~ "|" if 'TITLE' in params|upper else "") ~ params.MESSAGE %}

    {% if 'MESSAGE' in params|upper %}
        { action_respond_info(msg) }
    {% else %}
        { action_raise_error('Must provide MESSAGE parameter') }
    {% endif %}

[delayed_gcode SET_STEPPER_CURRENT] 
initial_duration: 2
gcode:
  _SET_PRINT_CURRENT
  M400
  REFRESH_SPOOLMAN
  M84
  M400
  update_git
  M400

[gcode_macro update_git]
gcode:
    {% set message = params.MESSAGE|default() %}
    {% if message %}
        RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
    {% else %}
        RUN_SHELL_COMMAND CMD=update_git_script
    {% endif %}

[gcode_shell_command update_git_script]
command: bash -c "bash $HOME/klipper-backup/script.sh"
timeout: 180.0
verbose: False

[gcode_shell_command update_git_script_message]
command: bash -c "bash $HOME/klipper-backup/script.sh $0"
timeout: 180.0
verbose: False

## Timelapse
[include timelapse.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 27.137
#*# pid_ki = 2.783
#*# pid_kd = 66.144
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 63.172
#*# pid_ki = 4.342
#*# pid_kd = 229.789
#*#
#*# [cartographer scan_model default]
#*# coefficients = 1.359970193303622,1.8186060378822904,0.8080718741931734,0.37731070280707457,0.5855803397213453,0.7149469817943342,-0.4444768396171237,-0.7278668842643472,0.49123332415330934,0.5185155918559101
#*# domain = 3.1384075662764236e-07,3.32558826345892e-07
#*# z_offset = 0
#*#
#*# [cartographer touch_model default]
#*# threshold = 3260
#*# speed = 2
#*# z_offset = -0.100
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.103102, 0.106125, 0.109137, 0.117965, 0.114964, 0.106125, 0.109137, 0.115150, 0.124147, 0.135901, 0.147588, 0.138874, 0.132827, 0.132923, 0.127142, 0.118157, 0.115150, 0.118157, 0.121154, 0.123961, 0.117965
#*# 	0.087960, 0.091185, 0.097151, 0.103102, 0.100269, 0.097245, 0.100082, 0.106125, 0.112146, 0.122557, 0.126950, 0.124147, 0.115150, 0.109137, 0.112052, 0.110641, 0.112146, 0.109137, 0.106125, 0.106125, 0.100082
#*# 	0.057744, 0.063893, 0.066961, 0.076141, 0.073085, 0.076141, 0.075958, 0.079010, 0.085102, 0.089570, 0.094217, 0.094217, 0.088143, 0.079200, 0.082058, 0.082058, 0.080534, 0.076141, 0.069841, 0.069841, 0.070025
#*# 	0.030049, 0.036273, 0.042293, 0.045390, 0.048669, 0.048483, 0.051668, 0.051572, 0.057744, 0.060820, 0.066961, 0.068401, 0.070025, 0.057744, 0.060820, 0.054657, 0.048483, 0.054657, 0.048483, 0.051764, 0.048483
#*# 	0.008317, 0.017740, 0.017646, 0.023997, 0.027119, 0.026931, 0.033163, 0.036273, 0.039378, 0.045390, 0.048483, 0.048669, 0.048669, 0.045576, 0.048576, 0.036273, 0.033163, 0.033163, 0.033163, 0.039378, 0.039378
#*# 	0.002207, 0.005169, 0.013030, 0.017740, 0.017740, 0.017740, 0.017740, 0.027119, 0.030049, 0.036273, 0.039378, 0.045576, 0.045576, 0.042479, 0.039378, 0.030236, 0.026931, 0.023809, 0.027119, 0.030049, 0.022340
#*# 	-0.004109, 0.002024, 0.011460, 0.017740, 0.013030, 0.011460, 0.014599, 0.020871, 0.023997, 0.026931, 0.033163, 0.039378, 0.042479, 0.039378, 0.036273, 0.030049, 0.022340, 0.020871, 0.020871, 0.023809, 0.023997
#*# 	-0.010443, -0.007274, 0.002207, 0.005169, 0.005169, 0.008317, 0.008317, 0.008317, 0.014599, 0.014599, 0.023997, 0.033163, 0.039378, 0.036273, 0.030236, 0.020871, 0.014599, 0.014599, 0.014599, 0.017740, 0.011460
#*# 	-0.029363, -0.013616, -0.007366, -0.001132, -0.001132, -0.000949, -0.004109, -0.001132, 0.002115, 0.006743, 0.014599, 0.020683, 0.023997, 0.023997, 0.019212, 0.009889, 0.008317, 0.002024, 0.005169, 0.008317, 0.002024
#*# 	-0.029548, -0.019976, -0.013616, -0.007457, -0.007274, -0.007457, -0.013616, -0.005783, -0.004109, 0.002024, 0.005169, 0.011460, 0.017740, 0.020871, 0.014599, 0.005169, 0.005358, -0.000949, 0.003597, 0.005264, -0.007274
#*# 	-0.037460, -0.022977, -0.013616, -0.007457, -0.007457, -0.007274, -0.013616, -0.010443, -0.007274, -0.004109, 0.002207, 0.005264, 0.013030, 0.014417, 0.011460, 0.005358, 0.005169, 0.002024, 0.002207, 0.002024, -0.004109
#*# 	-0.035766, -0.026168, -0.016794, -0.010443, -0.010443, -0.013616, -0.013616, -0.010627, -0.010443, -0.004293, -0.000949, 0.002024, 0.008317, 0.011460, 0.008317, 0.002024, -0.001132, -0.004109, -0.004293, -0.007274, -0.013616
#*# 	-0.032562, -0.022977, -0.013616, -0.005783, -0.001132, -0.004293, -0.007274, -0.007274, -0.000949, 0.002207, 0.008317, 0.005358, 0.014599, 0.017552, 0.017552, 0.009983, 0.005169, -0.001132, -0.001132, -0.000949, -0.004109
#*# 	-0.031055, -0.019791, -0.010443, -0.000949, 0.002207, -0.000949, -0.004201, -0.004293, -0.001132, 0.005169, 0.011460, 0.008317, 0.017740, 0.020683, 0.014599, 0.011460, 0.008317, 0.005169, 0.002024, 0.002024, -0.013616
#*# 	-0.029363, -0.013616, -0.004109, 0.008317, 0.011460, 0.002207, 0.002115, 0.005169, 0.008317, 0.011460, 0.014599, 0.014599, 0.020683, 0.020871, 0.017740, 0.014599, 0.011460, 0.008317, 0.008317, 0.005169, -0.004293
#*# 	-0.010443, -0.000949, 0.006838, 0.014599, 0.011460, 0.011460, 0.014599, 0.014599, 0.017646, 0.020871, 0.023997, 0.030049, 0.030049, 0.030049, 0.027025, 0.023903, 0.020871, 0.020683, 0.017740, 0.011460, -0.001043
#*# 	-0.007457, 0.005169, 0.014599, 0.020871, 0.020777, 0.020777, 0.020871, 0.023997, 0.023809, 0.030049, 0.033163, 0.040835, 0.045390, 0.045576, 0.039378, 0.033163, 0.030143, 0.027119, 0.026931, 0.020871, 0.011460
#*# 	0.005169, 0.011460, 0.020871, 0.023997, 0.023997, 0.023997, 0.023997, 0.026931, 0.033163, 0.039378, 0.043935, 0.053210, 0.054657, 0.054657, 0.048669, 0.039378, 0.033163, 0.030143, 0.026931, 0.026931, 0.011460
#*# 	0.011460, 0.027119, 0.033163, 0.039192, 0.036273, 0.033163, 0.033350, 0.039378, 0.043935, 0.051572, 0.057744, 0.066961, 0.069841, 0.069933, 0.063893, 0.054657, 0.045576, 0.042293, 0.042293, 0.039378, 0.031606
#*# 	0.039378, 0.045576, 0.048669, 0.048669, 0.051572, 0.051572, 0.048669, 0.051572, 0.056296, 0.063893, 0.070025, 0.076141, 0.085102, 0.085102, 0.075958, 0.066777, 0.060820, 0.060820, 0.060820, 0.056200, 0.042479
#*# 	0.054657, 0.069841, 0.069841, 0.070025, 0.066961, 0.065427, 0.069933, 0.069841, 0.072902, 0.082058, 0.088143, 0.094217, 0.100269, 0.100082, 0.094029, 0.088143, 0.091185, 0.091185, 0.085102, 0.082058, 0.075958
#*# min_x = 20.0
#*# min_y = 22.0
#*# max_x = 330.0
#*# max_y = 308.0
#*# x_count = 21
#*# y_count = 21
#*# mesh_x_pps = 0
#*# mesh_y_pps = 0
#*# algo = bicubic
#*# tension = 0.2
#*#
#*# [cartographer]
#*# z_backlash = 0.003869346235626514
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.009057, 0.013942, -0.001015, -0.002583, -0.019402
#*# compensation_start_x = 30.0
#*# compensation_end_x = 320.0
