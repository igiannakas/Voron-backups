#####################################################################
#   Happy Hare includes
#####################################################################
[include mmu/base/*.cfg]
[include mmu/optional/mmu_menu.cfg]

#####################################################################
#   File locations and on error handling
#####################################################################

[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

 
#####################################################################
#   Device ID's
#####################################################################
[mcu]
canbus_uuid: c0f599d7bb14 

[mcu EBBCan]
canbus_uuid: cd407005594f 

# canbus_uuid: 7d06e01afee5 # Stealthburner
# MMU: b9552979a1b0

#####################################################################
#   Basic Klipper and Printer setup
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500
max_accel: 20000   	
max_z_velocity: 35		
max_z_accel: 300	
square_corner_velocity: 5
minimum_cruise_ratio: 0.2

[exclude_object]
[print_stats]

[gcode_arcs]
resolution: 0.05

[idle_timeout]
timeout: 3600

[force_move]
enable_force_move: True


#####################################################################
#   Includes
#####################################################################

## Configuration files
[include timelapse.cfg]
[include mainsail.cfg]
[include config/stealthburner_leds.cfg]
[include config/extruder.cfg]
[include config/steppers.cfg]
[include config/temperature_sensors.cfg]
[include config/homing.cfg]
[include config/fans.cfg]
[include config/disco.cfg]
[include config/input_shaper.cfg]
[include config/display.cfg]

## Macros
[include macros/movement_macros.cfg]
[include macros/LED_macros.cfg]
[include macros/printing_macros.cfg]
[include macros/print_start_end.cfg]

## Cartographer macro
[include macros/cartographer_macros.cfg]

## MMU Macros
[include mmu/optional/client_macros.cfg]
[include mmu/addons/blobifier.cfg]
[include macros/custom_blobifier.cfg]
[include macros/custom_mmu_macros.cfg]

## Timelapse
[include timelapse.cfg]


#####################################################################
#   Stepper current delayed gcode and notification infrastructure
#####################################################################

[gcode_macro MR_NOTIFY]
description: Allows you to send a custom notification via Mobileraker without using the M117 command
gcode:
    {% set msg = "MR_NOTIFY:" ~ (params.TITLE ~ "|" if 'TITLE' in params|upper else "") ~ params.MESSAGE %}

    {% if 'MESSAGE' in params|upper %}
        { action_respond_info(msg) }
    {% else %}
        { action_raise_error('Must provide MESSAGE parameter') }
    {% endif %}

[delayed_gcode SET_STEPPER_CURRENT] 
initial_duration: 2
gcode:
  _SET_PRINT_CURRENT
  M400
  update_git
  M400
  REFRESH_SPOOLMAN
  M84

[gcode_macro update_git]
gcode:
    {% set message = params.MESSAGE|default() %}
    {% if message %}
        RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
    {% else %}
        RUN_SHELL_COMMAND CMD=update_git_script
    {% endif %}

[gcode_shell_command update_git_script]
command: bash -c "bash $HOME/klipper-backup/script.sh"
timeout: 90.0
verbose: True

[gcode_shell_command update_git_script_message]
command: bash -c "bash $HOME/klipper-backup/script.sh $0"
timeout: 90.0
verbose: True

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 27.137
#*# pid_ki = 2.783
#*# pid_kd = 66.144
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 63.172
#*# pid_ki = 4.342
#*# pid_kd = 229.789
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.073067, 0.081887, 0.086937, 0.085845, 0.082177, 0.081999, 0.085869, 0.094517, 0.104701, 0.106194, 0.103608, 0.099433, 0.094061, 0.088059, 0.076536, 0.076986, 0.081284, 0.075816, 0.078086
#*# 	  0.058255, 0.061551, 0.065336, 0.067491, 0.064318, 0.065178, 0.066738, 0.073162, 0.081709, 0.086591, 0.085398, 0.077067, 0.072588, 0.068000, 0.057248, 0.054994, 0.054668, 0.054409, 0.057944
#*# 	  0.027799, 0.031056, 0.034834, 0.036810, 0.035831, 0.034250, 0.035927, 0.040539, 0.047482, 0.053429, 0.053164, 0.049050, 0.043560, 0.035181, 0.027761, 0.026779, 0.027057, 0.029355, 0.032716
#*# 	  0.007725, 0.012213, 0.017032, 0.018242, 0.015278, 0.017980, 0.023133, 0.029441, 0.035138, 0.040176, 0.038117, 0.039190, 0.036774, 0.029390, 0.021428, 0.018413, 0.019122, 0.022059, 0.025805
#*# 	  -0.001701, 0.008866, 0.009462, 0.011184, 0.006631, 0.008520, 0.013056, 0.019237, 0.026754, 0.033485, 0.032814, 0.030640, 0.027354, 0.022356, 0.015371, 0.012524, 0.009944, 0.011338, 0.014701
#*# 	  -0.003942, 0.000769, 0.006718, 0.002438, 0.004263, 0.006781, 0.007106, 0.014577, 0.018352, 0.026920, 0.031844, 0.031163, 0.027108, 0.020957, 0.012202, 0.007801, 0.008993, 0.009242, 0.015381
#*# 	  -0.020958, -0.014545, -0.006920, -0.005970, -0.008160, -0.007297, -0.005366, 0.000793, 0.005077, 0.012477, 0.016256, 0.018578, 0.012486, 0.006687, -0.004109, -0.008557, -0.008753, -0.008410, -0.002783
#*# 	  -0.029348, -0.021649, -0.014253, -0.012136, -0.016399, -0.019268, -0.014704, -0.011416, -0.005592, 0.002972, 0.005234, 0.009469, 0.005998, -0.003414, -0.010782, -0.014479, -0.012108, -0.010627, -0.007805
#*# 	  -0.031192, -0.022336, -0.016415, -0.013678, -0.015097, -0.020717, -0.018878, -0.014588, -0.004044, -0.000950, -0.001325, 0.003392, 0.001649, -0.002751, -0.011771, -0.012849, -0.011791, -0.010854, -0.007059
#*# 	  -0.040625, -0.029358, -0.021051, -0.014846, -0.020342, -0.023659, -0.019856, -0.016838, -0.010360, -0.006075, -0.008107, -0.000634, -0.002083, -0.005295, -0.014561, -0.018601, -0.020403, -0.022703, -0.019255
#*# 	  -0.031108, -0.021745, -0.011086, -0.007541, -0.006555, -0.008914, -0.007777, -0.002257, -0.001152, 0.003881, 0.001394, 0.010003, 0.008151, 0.002012, -0.004652, -0.010608, -0.013540, -0.015549, -0.013587
#*# 	  -0.029066, -0.018422, -0.008463, -0.003576, -0.002252, -0.008833, -0.005471, -0.002756, 0.003605, 0.009129, 0.005511, 0.008733, 0.006296, 0.001233, -0.001713, -0.008552, -0.015269, -0.016061, -0.013384
#*# 	  -0.011584, -0.001953, 0.003874, 0.007313, 0.003414, 0.005978, 0.010382, 0.010453, 0.012503, 0.014719, 0.016850, 0.018503, 0.016599, 0.014317, 0.006748, -0.001474, -0.002421, -0.006962, -0.006469
#*# 	  0.000017, 0.006631, 0.014173, 0.017106, 0.017396, 0.018482, 0.018481, 0.023463, 0.026231, 0.028287, 0.036914, 0.033140, 0.029309, 0.025790, 0.019453, 0.017175, 0.008702, 0.001191, 0.007515
#*# 	  0.012724, 0.017012, 0.022309, 0.026746, 0.026645, 0.026565, 0.025456, 0.030940, 0.037788, 0.038658, 0.046558, 0.044885, 0.040943, 0.033425, 0.023640, 0.017339, 0.015541, 0.011670, 0.012841
#*# 	  0.030745, 0.035218, 0.037421, 0.039345, 0.038741, 0.041529, 0.039808, 0.045370, 0.052806, 0.058163, 0.062086, 0.063899, 0.058080, 0.050789, 0.038971, 0.034312, 0.033465, 0.028822, 0.031944
#*# 	  0.050109, 0.054648, 0.055865, 0.053824, 0.054422, 0.053011, 0.052597, 0.056532, 0.061655, 0.069306, 0.073506, 0.075472, 0.070764, 0.061769, 0.050670, 0.046734, 0.045406, 0.044315, 0.047442
#*# 	  0.075251, 0.081869, 0.080183, 0.079249, 0.077988, 0.076141, 0.077904, 0.081715, 0.088137, 0.093175, 0.093560, 0.095185, 0.092547, 0.081576, 0.074898, 0.072917, 0.071936, 0.072616, 0.077327
#*# 	  0.088409, 0.097416, 0.099700, 0.097619, 0.097195, 0.096020, 0.097196, 0.100228, 0.104745, 0.109384, 0.107978, 0.108466, 0.107067, 0.098541, 0.086051, 0.083425, 0.083976, 0.085537, 0.089997
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 330.0
#*# min_y = 30.0
#*# max_y = 330.0
#*#
#*# [scanner]
#*# scanner_touch_threshold = 2250
#*# mode = touch
#*# scanner_touch_speed = 2
#*#
#*# [scanner model default]
#*# model_coef = 1.4112579398167724,
#*# 	1.7609518161418167,
#*# 	0.7093386935927368,
#*# 	-0.009107122019047986,
#*# 	0.719273808975602,
#*# 	1.8894494278669896,
#*# 	-0.8841241133855349,
#*# 	-2.5180398632458543,
#*# 	0.6923142795025283,
#*# 	1.3273966983811747
#*# model_domain = 3.14245606644885e-07,3.320475636326169e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 22.251642
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
